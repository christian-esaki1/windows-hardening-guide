# Create-Hardening-Docs.ps1
# Script pour g√©n√©rer automatiquement la documentation compl√®te sur le hardening

Write-Host "==========================================" -ForegroundColor Cyan
Write-Host "  Cr√©ation Documentation Hardening       " -ForegroundColor Cyan
Write-Host "==========================================" -ForegroundColor Cyan
Write-Host ""

# V√©rifier qu'on est dans le bon dossier
$currentPath = Get-Location
Write-Host "üìÅ Dossier actuel : $currentPath" -ForegroundColor Yellow
Write-Host ""

# Cr√©er le dossier docs s'il n'existe pas
if(!(Test-Path "docs")) {
    New-Item -ItemType Directory -Path "docs" -Force | Out-Null
    Write-Host "‚úì Dossier docs/ cr√©√©" -ForegroundColor Green
}

# ============================================
# FICHIER 1 : hardening.md (Guide complet)
# ============================================

$hardeningContent = @'
# üõ°Ô∏è Guide de Durcissement Windows 10/11

> Guide complet pour renforcer la s√©curit√© des postes de travail Windows dans un contexte PME/TPE

---

## Table des Mati√®res

1. [Introduction](#introduction)
2. [Pr√©requis](#pr√©requis)
3. [Durcissement de Base](#durcissement-de-base)
4. [Durcissement Avanc√©](#durcissement-avanc√©)
5. [Scripts Automatis√©s](#scripts-automatis√©s)
6. [V√©rification](#v√©rification)
7. [Maintenance](#maintenance)

---

## Introduction

Le durcissement (hardening) consiste √† r√©duire la surface d'attaque d'un syst√®me en :
- D√©sactivant les fonctionnalit√©s non utilis√©es
- Renfor√ßant les configurations de s√©curit√©
- Appliquant le principe du moindre privil√®ge
- Limitant l'exposition aux menaces

### Objectifs

- ‚úÖ R√©duire les vuln√©rabilit√©s exploitables
- ‚úÖ Limiter l'impact d'une compromission
- ‚úÖ Respecter les bonnes pratiques de s√©curit√© (CIS, NIST, ANSSI)
- ‚úÖ Faciliter la d√©tection d'incidents

---

## Pr√©requis

### Avant de Commencer

‚ö†Ô∏è **CRITIQUE** : Cr√©ez TOUJOURS une sauvegarde compl√®te avant toute modification

Cr√©er un point de restauration
Checkpoint-Computer -Description "Avant durcissement $(Get-Date -Format 'yyyy-MM-dd')" -RestorePointType "MODIFY_SETTINGS"

V√©rifier que le point a √©t√© cr√©√©
Get-ComputerRestorePoint | Select-Object -First 1

text

### Droits Requis

- Compte administrateur local
- PowerShell 5.1+ en mode √©lev√©
- Connexion Internet (pour mises √† jour)

### Environnement de Test

**Recommand√©** : Testez d'abord sur :
- Machine virtuelle (VirtualBox, VMware, Hyper-V)
- Windows Sandbox
- Poste de test d√©di√©

---

## Durcissement de Base

### 1. Windows Defender

#### Activation et Configuration Compl√®te

Activer la protection en temps r√©el
Set-MpPreference -DisableRealtimeMonitoring $false

Activer la protection cloud (MAPS)
Set-MpPreference -MAPSReporting Advanced

Activer l'envoi automatique d'√©chantillons
Set-MpPreference -SubmitSamplesConsent SendAllSamples

Activer la protection contre les PUA
Set-MpPreference -PUAProtection Enabled

Activer l'analyse des scripts
Set-MpPreference -DisableScriptScanning $false

Activer la protection r√©seau
Set-MpPreference -EnableNetworkProtection Enabled

Mettre √† jour les signatures
Update-MpSignature

V√©rifier l'√©tat
Get-MpComputerStatus | Select-Object AntivirusEnabled, RealTimeProtectionEnabled, NISEnabled

text

#### Protection Anti-Ransomware (Controlled Folder Access)

Activer Controlled Folder Access
Set-MpPreference -EnableControlledFolderAccess Enabled

Ajouter des dossiers prot√©g√©s suppl√©mentaires
Add-MpPreference -ControlledFolderAccessProtectedFolders "C:\Documents", "C:\Projets"

Autoriser des applications de confiance si n√©cessaire
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Program Files\MonApp\app.exe"
text

#### Attack Surface Reduction (ASR Rules)

Bloquer les ex√©cutables provenant d'emails
Add-MpPreference -AttackSurfaceReductionRules_Ids BE9BA2D9-53EA-4CDC-84E5-9B1EEEE46550 -AttackSurfaceReductionRules_Actions Enabled

Bloquer JavaScript/VBScript lanc√©s depuis Internet
Add-MpPreference -AttackSurfaceReductionRules_Ids D3E037E1-3EB8-44C8-A917-57927947596D -AttackSurfaceReductionRules_Actions Enabled

Bloquer l'ex√©cution de scripts potentiellement obfusqu√©s
Add-MpPreference -AttackSurfaceReductionRules_Ids 5BEB7EFE-FD9A-4556-801D-275E5FFC04CC -AttackSurfaceReductionRules_Actions Enabled

Bloquer Win32 API calls depuis Office macros
Add-MpPreference -AttackSurfaceReductionRules_Ids 92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B -AttackSurfaceReductionRules_Actions Enabled

Bloquer la cr√©ation de processus par Office
Add-MpPreference -AttackSurfaceReductionRules_Ids D4F940AB-401B-4EFC-AADC-AD5F3C50688A -AttackSurfaceReductionRules_Actions Enabled

text

---

### 2. Pare-feu Windows

#### Configuration Globale

Activer le pare-feu sur tous les profils
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled True

Configurer le comportement par d√©faut : bloquer entrant, autoriser sortant
Set-NetFirewallProfile -Profile Domain,Public,Private -DefaultInboundAction Block -DefaultOutboundAction Allow

Activer la journalisation
Set-NetFirewallProfile -Profile Domain,Public,Private -LogAllowed True -LogBlocked True -LogMaxSizeKilobytes 4096

V√©rifier la configuration
Get-NetFirewallProfile | Format-Table Name, Enabled, DefaultInboundAction, DefaultOutboundAction

text

#### R√®gles de S√©curit√© Sp√©cifiques

Bloquer SMB entrant (sauf si n√©cessaire pour partage r√©seau)
New-NetFirewallRule -DisplayName "Block SMB Inbound" -Direction Inbound -Protocol TCP -LocalPort 445 -Action Block -Enabled True

Bloquer NetBIOS
New-NetFirewallRule -DisplayName "Block NetBIOS UDP" -Direction Inbound -Protocol UDP -LocalPort 137,138 -Action Block
New-NetFirewallRule -DisplayName "Block NetBIOS TCP" -Direction Inbound -Protocol TCP -LocalPort 139 -Action Block

Restreindre RDP √† des IP sp√©cifiques (remplacer par votre r√©seau)
New-NetFirewallRule -DisplayName "RDP Restricted" -Direction Inbound -Protocol TCP -LocalPort 3389 -RemoteAddress 192.168.1.0/24 -Action Allow
text

---

### 3. Gestion des Comptes Utilisateurs

#### D√©sactivation des Comptes par D√©faut

D√©sactiver le compte Administrator
net user Administrator /active:no

D√©sactiver le compte Guest
net user Guest /active:no

Lister les comptes actifs
Get-LocalUser | Where-Object {$_.Enabled -eq $true} | Format-Table Name, Enabled, LastLogon

text

#### Politiques de Mots de Passe

Longueur minimale : 12 caract√®res
net accounts /minpwlen:12

Dur√©e de validit√© : 90 jours
net accounts /maxpwage:90

Historique : m√©moriser les 5 derniers mots de passe
net accounts /uniquepw:5

V√©rifier la configuration
net accounts

text

#### Verrouillage de Compte

Verrouiller apr√®s 5 tentatives √©chou√©es
net accounts /lockoutthreshold:5

Dur√©e de verrouillage : 30 minutes
net accounts /lockoutduration:30

R√©initialiser le compteur apr√®s : 30 minutes
net accounts /lockoutwindow:30

text

---

### 4. Protocoles et Services Obsol√®tes

#### D√©sactiver SMBv1 (vuln√©rable √† WannaCry)

D√©sactiver SMBv1
Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart

V√©rifier que SMBv1 est d√©sactiv√©
Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol

Alternative via configuration SMB
Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force

text

#### D√©sactiver NetBIOS sur TCP/IP

D√©sactiver NetBIOS sur toutes les interfaces r√©seau
$adapters = Get-WmiObject Win32_NetworkAdapterConfiguration -Filter "IPEnabled=True"
foreach($adapter in $adapters) {
$adapter.SetTcpipNetbios(2) # 2 = D√©sactiv√©
}

V√©rifier
Get-WmiObject Win32_NetworkAdapterConfiguration -Filter "IPEnabled=True" | Select-Object Description, TcpipNetbiosOptions

text

#### D√©sactiver les Services Non N√©cessaires

$servicesToDisable = @(
"RemoteRegistry", # Registre distant
"SSDPSRV", # D√©couverte SSDP (UPnP)
"upnphost", # H√¥te de p√©riph√©rique UPnP
"WMPNetworkSvc", # Partage r√©seau Windows Media Player
"RemoteAccess", # Routage et acc√®s distant
"lltdsvc", # Mappage de topologie de couche liaison
"XblAuthManager", # Xbox Live (si non utilis√©)
"XblGameSave", # Xbox Live Game Save
"XboxNetApiSvc" # Xbox Live Networking
)

foreach($service in $servicesToDisable) {
try {
$svc = Get-Service -Name $service -ErrorAction SilentlyContinue
if($svc) {
Stop-Service -Name $service -Force -ErrorAction SilentlyContinue
Set-Service -Name $service -StartupType Disabled
Write-Host "‚úì Service $service d√©sactiv√©" -ForegroundColor Green
}
}
catch {
Write-Host "‚ö† Impossible de d√©sactiver $service" -ForegroundColor Yellow
}
}

text

---

### 5. Mises √† Jour et Patches

#### Installation du Module PSWindowsUpdate

Installer le module
Install-Module PSWindowsUpdate -Force -SkipPublisherCheck

V√©rifier les mises √† jour disponibles
Get-WindowsUpdate

Installer toutes les mises √† jour
Install-WindowsUpdate -AcceptAll -AutoReboot

Consulter l'historique
Get-WUHistory | Select-Object -First 10

text

#### Activer les Mises √† Jour Automatiques

Via le registre
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" -Name "NoAutoUpdate" -Value 0 -Force
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" -Name "AUOptions" -Value 4 -Force

text

---

## Durcissement Avanc√©

### 6. Chiffrement BitLocker

#### Activer BitLocker

V√©rifier le support TPM
Get-Tpm

Activer BitLocker sur C: avec chiffrement XTS-AES 256
Enable-BitLocker -MountPoint "C:" -EncryptionMethod XtsAes256 -UsedSpaceOnly -TpmProtector

Sauvegarder la cl√© de r√©cup√©ration
$recoveryKey = (Get-BitLockerVolume -MountPoint "C:").KeyProtector | Where-Object {$.KeyProtectorType -eq "RecoveryPassword"}
$recoveryKey.RecoveryPassword | Out-File "C:\BitLocker_Recovery$(Get-Date -Format 'yyyyMMdd').txt"

Write-Host "‚ö†Ô∏è CRITIQUE : Sauvegardez ce fichier dans un emplacement s√©curis√© HORS du PC !" -ForegroundColor Red

text

---

### 7. Audit et Journalisation

#### Activer l'Audit des √âv√©nements Critiques

Audit des connexions
auditpol /set /subcategory:"Logon" /success:enable /failure:enable
auditpol /set /subcategory:"Logoff" /success:enable

Audit des modifications de fichiers
auditpol /set /subcategory:"File System" /success:enable /failure:enable

Audit des modifications du registre
auditpol /set /subcategory:"Registry" /success:enable /failure:enable

Audit de la gestion des comptes
auditpol /set /subcategory:"User Account Management" /success:enable /failure:enable
auditpol /set /subcategory:"Security Group Management" /success:enable /failure:enable

Audit des changements de politique
auditpol /set /subcategory:"Audit Policy Change" /success:enable /failure:enable

V√©rifier la configuration
auditpol /get /category:*

text

#### Augmenter la Taille des Logs

Augmenter √† 100 MB
wevtutil sl Security /ms:104857600
wevtutil sl System /ms:104857600
wevtutil sl Application /ms:104857600

V√©rifier
wevtutil gli Security | Select-String "maxSize"

text

---

### 8. User Account Control (UAC)

#### Renforcer UAC

Configurer UAC au niveau maximum
Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\
